
<div class="container">
    <div class="row" *ngIf="bankList; else loading">
        <div class="col-md-6 offset-md-3">
            <div class="card  my-4 border rounded" *ngIf="bankList.length">
                <!-- <div class="card-title mt-2">Dispense Cash</div> -->
                <div *ngIf='page==="withdraw"' class="card-body text-center p-4">
                    <div class="balance-sec">
                        <ng-container *ngIf="selectCurrency; else loadingBank">
                            <h5>{{selectCurrency?.sign}}{{(selectCurrency?.balance | number) || '0.00'}}</h5>
                             <p>Available Balance</p>
                            <p><span class="badge badge-light badge-pill">{{selectCurrency?.symbol}}</span> </p>
                        </ng-container>
                        <ng-template #loadingBank>
                            <i class="fa fa-spinner fa-spin fa-2x"></i>
                            <p>Loading Bank Details</p>
                        </ng-template>
                    </div>
                    <h6 *ngIf="errMsg" class=" text-danger mt-1">{{errMsg}}</h6>
                    <div class="text-left mt-3">
                        <form [formGroup]="withdrawForm">
                            <div class="form-group">
                                <label for="bank">Withdraw to</label>
                                <select formControlName="currency" (change)="changeBank()" name="" id="bank" class="form-control">
                                    <option value="" disabled>Select Bank</option>
                                    <option [value]="bank.currency" *ngFor="let bank of bankList">
                                        {{bank.bankName+'   '+'('+bank.currency+')'}}
                                    </option>
                                </select>
                            </div>
                   
                            <div class="form-group">
                                <label for="bank">Amount</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">{{selectCurrency?.sign||'#'}}</div>
                                    </div>
                                    <input formControlName="amount" type="number" class="form-control" placeholder="100">
                                </div>
                            </div>
                            <div class="form-group my-3">
                                <p class=" text-muted mb-2">
                                    <span>Transactions fees</span>
                                    <span class=" float-right">{{selectCurrency?.sign || '#'}}
                                        {{(getTransFee | number)|| '0.00'}}</span>
                                </p>
                                <h6 class="">
                                    <span class=" text-left">Amount to Withdraw </span>
                                    <span class=" text-right float-right">{{selectCurrency?.sign || '#'}}
                                        {{(withdrawForm.value.amount | number)|| '0.00'}}</span>
                                </h6>
                            </div>
                            <div class="form-group">
                                <button (click)="validateAmount()" 
                                    [disabled]="!(withdrawForm.value.amount&&withdrawForm.value.currency)||!selectCurrency" 
                                        class="my-3 py-2 btn btn-block btn-blue">
                                    <span *ngIf="!validateLoading">Next <i class="fa fa-forward"></i></span>
                                    <app-loader *ngIf="validateLoading"></app-loader>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div *ngIf="page==='confirm'" class="card-body p-4">
                    <div class="alert alert-primary text-center p-3" role="alert">
                        <h6 class="mb-2">You are Withdrawing</h6>
                        <h6 class="mb-2">to</h6>
                        <h6 class="mb-2"><b>{{selectedBank?.bankName}} - {{selectedBank?.accountNo}}</b></h6>
                        <h6 class="mb-1"><b>{{selectedBank?.accountName}}</b></h6>
                      </div>
                      <p class="mt-1 text-center text-danger" *ngIf="errMsg">{{errMsg}}</p>
                      <div class="my-2">
                        <p class=" text-muted mb-2">
                            <span>Transactions fees</span>
                            <span class=" float-right">{{selectCurrency?.sign || '#'}}
                                {{(getTransFee | number)|| '0.00'}}</span>
                        </p>
                        <h6 class="mb-1 ft-weight-400">
                            <span class=" text-left">Amount to Withdraw </span>
                            <span class=" text-right float-right">{{selectCurrency?.sign || '#'}}
                                {{(withdrawForm.value.amount | number)|| '0.00'}}</span>
                        </h6>
                        <hr class=" m-0 my-2 ">
                        <h6 class="mb-1">
                            <span>Total Amout</span>
                            <span class=" float-right">{{selectCurrency?.sign || '#'}}
                                {{(getTransFee+withdrawForm.value.amount | number)|| '0.00'}}</span>
                        </h6>
                    </div>
                    <div [formGroup]="withdrawForm" class="form-group mt-1">
                        <input size="5" type="password" formControlName="pin" placeholder="Enter 5 Digits Pin" class="form-control text-center">
                    </div>
                    <div class="mt-2">
                        <button (click)="withdraw()" [disabled]="!validPin||validateLoading" class=" btn btn-blue btn-block py-2">
                            <span *ngIf="!validateLoading">Withdraw</span>
                            <app-loader *ngIf="validateLoading"></app-loader>
                        </button>
                    </div>
                </div>
                <div class="p-4" *ngIf="page==='trans-summary'">
                    <div class="card-header text-center">
                        <div class="card-title">Transaction Summary</div>
                        <i class="fa fa-check-circle fa-3x text-success"></i>
                    </div>
                    <div class="card-body">
                        <div class="tr-row">
                            <p>You Recieve</p>
                            <h6>{{selectCurrency?.sign || '#'}}
                                {{(withdrawForm.value.amount | number)|| '0.00'}}</h6>
                        </div>
                        <div class="tr-row">
                            <p>Transfer Fee</p>
                            <h6>{{selectCurrency?.sign || '#'}}
                                {{(getTransFee | number)|| '0.00'}}</h6>
                        </div>
                        <div class="tr-row">
                            <p>Total Amount</p>
                            <h6>{{selectCurrency?.sign || '#'}}
                                {{(getTransFee+withdrawForm.value.amount | number)|| '0.00'}}</h6>
                        </div>
                        <div class="tr-row">
                            <p>Status</p>
                            <h6 class="text-warning">Pending</h6>
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        <a routerLink="/dashboard" class="btn btn-blue text-light">Done</a>
                    </div>
                </div>
            </div>
            <div *ngIf="!bankList.length" class="card empty-trans  my-4 py-3 border rounded">
                <img src="/assets/images/bank_1.png" width="25%" alt="bank">
                <h5 class="mt-2">There is no bank for withdraw</h5>
                <a routerLink="/user-profile" [queryParams]="{view:'bank-card'}" class=" btn btn-outline-primary my-3">Add Bank</a>
            </div>
        </div>
    </div>
    <ng-template #loading>
        <app-loader [type]="'wave'" ></app-loader>
      </ng-template>
</div>